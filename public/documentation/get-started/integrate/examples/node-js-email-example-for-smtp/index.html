
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Node.js Email Example For SMTP - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Node.js Email Example for SMTP May 7th, 2012 If you are using Node.js and would like to send email through SendGrid, we&#8217;ve put together a nice &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/documentation/get-started/integrate/examples/node-js-email-example-for-smtp/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Node.js Email Example for SMTP</h1>
    <p class="meta">








  


<time datetime="2012-05-07T09:52:11-06:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time></p>
  </header>
  
  <p>If you are using Node.js and would like to send email through SendGrid, we&#8217;ve put together a nice module to handle this for you. It is available with the MIT license, and you can install it like this:</p>

<p><code>npm install sendgrid-nodejs</code></p>

<p>Once you have the module installed, it can be as simple as the following code snippet, modified to your specifics, of course:</p>

<p>`
var SendGrid = require(&#8216;sendgrid&#8217;).SendGrid;
var sendgrid = new SendGrid(user, key);
sendgrid.send({
  to: &#8216;example@example.com&#8217;,
  from: &#8216;other@example.com&#8217;,
  subject: &#8216;Hello World&#8217;,
  text: &#8216;My first email through SendGrid&#8217;
}, function(success, message) {
  if (!success) {</p>

<pre><code>console.log(message);
</code></pre>

<p>  }
});
`</p>

<h3>Digging In Deeper</h3>

<p>Email is the object that will help you easily prepare your message to be sent.</p>

<p>NOTE: anything that is available in the Email constructor is available for use in both the sendgrid.send and sendgrid.smtp functions.</p>

<p>To get started create an Email object:</p>

<p><code>
var Email = require('sendgrid').Email;
var email = new Email(optionalParams);
</code></p>

<p>You can pass in as much or as little to optionalParams as you want, as the email object has methods for manipulating all of the data.</p>

<p>Here is how the parameters are structured:</p>

<p>`
var optionalParams = {
  to: [],
  from: &#8221;,
  smtpapi: new SmtpapiHeaders(),
  subject: &#8221;,
  text: &#8221;,
  html: &#8221;,
  bcc: [],
  replyto: &#8221;,
  date: new Date(),
  files: [</p>

<pre><code>{
  filename: '',          // required only if file.content is used.
  contentType: '',       // optional
  path: '',              //
  url: '',               // == One of these three options is required
  content: ('' | Buffer) //
}
</code></pre>

<p>  ],
  file_data: {},
  headers: {}
};
`</p>

<p>And here is a sample for using it:</p>

<p><code>
var email = new Email({
  to: 'walks.it.in@sample.com',
  from: 'arsenal@sample.com',
  subject: 'What was Wenger thinking sending Walcott on that early?',
  text: 'Did you see that ludicrous display last night?'
});
</code></p>

<h3>Setting data</h3>

<p>Here is an example of all of the functions available on the email object. The comments to the right show the current state of the variables as the functions are called.</p>

<p><code>
var email = new Email({
  to: 'denim@sample.com',
  from: 'roy@sample.com',
  subject: 'Listen',
  text: 'Have you tried turning it off and on again'
});
</code></p>

<p>The following examples update the &#8216;x-smtpapi&#8217; headers:</p>

<p>`
/<em> To Addresses </em>/
email.addTo(&#8216;moo@cow.com&#8217;);       // to = [&#8216;moo@cow.com&#8217;]
email.addTo([&#8216;solid@snake.com&#8217;,</p>

<pre><code>        'liquid@snake.com']); // to = ['moo@cow.com', 'solid@snake.com', 'liquid@snake.com']
</code></pre>

<p>/<em> Custom Email Headers </em>/
email.setHeaders({full: &#8216;hearts&#8217;});   // headers = {full: &#8216;hearts&#8217;}
email.addHeaders({spin: &#8216;attack&#8217;});   // headers = {full: &#8216;hearts&#8217;, spin: &#8216;attack&#8217;}
email.setHeaders({mask: &#8216;salesman&#8217;}); // headers = {mask: &#8216;salesman&#8217;}</p>

<p>/<em> Substitution </em>/
email.addSubVal(&#8216;keep&#8217;, &#8216;secret&#8217;); // sub = {keep: [&#8216;secret&#8217;]}
email.addSubVal(&#8216;keep&#8217;, &#8216;safe&#8217;);   // sub = {keep: [&#8216;secret&#8217;, &#8216;safe&#8217;]}</p>

<p>/<em> Section </em>/
email.setSection({&#8216;-charge-&#8216;: &#8216;This ship is useless.&#8217;}); // section = {&#8216;-charge-&#8216;: &#8216;This ship is useless.&#8217;}
email.addSection({&#8216;-bomber-&#8216;: &#8216;Only for sad vikings.&#8217;}); // section = {&#8216;-charge-&#8216;: &#8216;This ship is useless.&#8217;,&#8217;-bomber-&#8216;: &#8216;Only for sad vikings.&#8217;}
email.setSection({&#8216;-beam-&#8216;: &#8216;The best is for first&#8217;});   // section = {&#8216;-beam-&#8216;: &#8216;The best is for first&#8217;}
`</p>

<p>Setting unique arguments allows you to get more mojo out of your statistics:</p>

<p><code>
email.setUniqueArgs({cow: 'chicken'}); // unique_args = {cow: 'chicken'}
email.addUniqueArgs({cat: 'dog'});     // unique_args = {cow: 'chicken', cat: 'dog'}
email.setUniqueArgs({dad: 'proud'});   // unique_args = {dad: 'proud'}
</code></p>

<p>You can set categories with the following:</p>

<p><code>
email.setCategory('tactics');        // category = ['tactics']
email.addCategory('advanced');       // category = ['tactics', 'advanced']
email.setCategory('snowball-fight'); // category = ['snowball-fight']
</code></p>

<p>You can set a filter using an object literal:</p>

<p>`
email.setFilterSetting({
  &#8216;footer&#8217;: {</p>

<pre><code>'setting': {
  'enable': 1,
  'text/plain': 'You can haz footers!'
}
</code></pre>

<p>  }
});
`</p>

<p>Alternatively, you can add filter settings one at a time.</p>

<p><code>
email.addFilterSetting('footer', 'enable', 1);
email.addFilterSetting('footer', 'text/html', '**boo**');
</code></p>

<p>You can add files as attachments directly from content stored in memory, like so:</p>

<p><code>
email.addFile({
  filename: 'secret.txt',
  content:  new Buffer('You will never know....')
});
</code></p>

<p>Alternately, you can include files from a remote URL and will attempt to determine the file type based on the filename:</p>

<p><code>
email.addFile({
  filename: 'icon.jpg',
  url: 'http://i.imgur.com/2fDh8.jpg'
});
</code></p>

<p>Finally, you can add file from a path on the server&#8217;s local filesystem, also attempting to determine the filetype via the filename:</p>

<p><code>
email.addFile({
  path: '../files/resume.txt'
});
</code></p>

<h3>Testing Your Code</h3>

<p>Tests located in the <em>test/lib</em> folder can be ran as-is and should all pass if your code is valid. Tests that are located in the <em>test/intergration</em> folder require valid SendGrid account credentials inserted into <em>test/test.setup</em> in order to run.</p>

<p><strong><em>Note: Testing your code requires a valid SendGrid account and will consume credits</em></strong></p>

<p>When you&#8217;re ready, you can run your tests with this command:</p>

<p><code>make test</code></p>

<p><em><strong>TIP: You can run individual tests with mocha /path/to/test.test.js</strong></em></p>

  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2012-05-07T09:52:11-06:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time>
        
      </p>
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://yoursite.com/documentation/get-started/integrate/examples/node-js-email-example-for-smtp/index.html" data-via="" data-counturl="http://yoursite.com/documentation/get-started/integrate/examples/node-js-email-example-for-smtp/index.html" >Tweet</a>
  
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2011/10/06/valid-passwords/">Valid Passwords</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/07/27/billing-error-code/">Billing Error Code</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/27/how-to-eliminate-the-on-behalf-of-message/">How To: Eliminate the On Behalf Of Message</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/27/spf-records-dont-have-more-than-10-dns-lookups/">SPF Records:  Don't have more than 10 DNS lookups!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/06/21/what-is-throttling/">What is Throttling?</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
